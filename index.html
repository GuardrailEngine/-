<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>AEGIS | CLOUD GENERATOR</title>
    <style>
        body { background: #020202; color: #D4AF37; font-family: 'Courier New', monospace; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; flex-direction: column; }
        .gen-box { border: 2px solid #D4AF37; padding: 30px; text-align: center; background: #0a0a0a; box-shadow: 0 0 30px rgba(212, 175, 55, 0.2); width: 90%; max-width: 500px; }
        button { background: transparent; border: 1px solid #00f2ff; color: #00f2ff; padding: 12px; cursor: pointer; margin: 10px 5px; font-weight: bold; width: 45%; transition: 0.3s; }
        button:hover { background: #00f2ff; color: #000; }
        #status { font-size: 0.7rem; color: #00f2ff; margin-top: 10px; }
        #keyList { margin-top: 20px; color: #fff; font-size: 0.8rem; text-align: left; border-top: 1px solid #333; padding-top: 10px; }
    </style>
</head>
<body>

<div class="gen-box">
    <h2>AEGIS CORE GENERATOR</h2>
    <p style="color:#666; font-size:0.7rem;">ارتباط السحابة: مـفـعـل</p>
    
    <button onclick="generateLocalKey()">توليد مفتاح</button>
    <button id="cloudBtn" onclick="uploadToCloud()" style="border-color:#D4AF37; color:#D4AF37;" disabled>رفع للسحابة</button>
    
    <div id="status">جاهز للعمل...</div>
    <div id="keyList"></div>
</div>

<script>
    // الإحداثيات المستخرجة من صورتك
    const S_URL = "https://mutqxosorqevcmbqgbwn.supabase.co";
    const S_KEY = "sb_publishable_gNwhjS_UpBfgwrNyLO7nsw_HBbhlag9";
    
    let lastKey = "";

    function generateLocalKey() {
        const random = Math.random().toString(36).substr(2, 6).toUpperCase();
        lastKey = `AEGIS-${random}-2026`;
        document.getElementById('keyList').innerHTML = `<strong>المفتاح الحالي:</strong><br>${lastKey}`;
        document.getElementById('cloudBtn').disabled = false;
        document.getElementById('status').innerText = "تم التوليد محلياً. اضغط للرفع.";
    }

    async function uploadToCloud() {
        document.getElementById('status').innerText = "جاري الاتصال بالسحابة...";
        try {
            const response = await fetch(`${S_URL}/rest/v1/sovereign_keys`, {
                method: 'POST',
                headers: {
                    'apikey': S_KEY,
                    'Authorization': `Bearer ${S_KEY}`,
                    'Content-Type': 'application/json',
                    'Prefer': 'return=minimal'
                },
                body: JSON.stringify({ key_code: lastKey, is_active: true })
            });

            if (response.ok) {
                document.getElementById('status').innerText = "✅ تم حفظ المفتاح في الخزنة بنجاح!";
                document.getElementById('cloudBtn').disabled = true;
            } else {
                document.getElementById('status').innerText = "❌ خطأ في الرفع. تأكد من إعدادات الجدول.";
            }
        } catch (err) {
            document.getElementById('status').innerText = "❌ فشل الاتصال بالسيرفر.";
        }
    }
</script>
</body>
</html>
